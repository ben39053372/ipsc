# Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

orbs: # declare what orbs we are going to use
  node: circleci/node@2.0.2 # the node orb provides common node-related configuration

# Orchestrate or schedule a set of jobs
workflows:
  version: 1
  build_and_test:
    jobs:
      - build:
          filters:
            branches:
              ignore: production
      - deploy:
          requires:
            - build


jobs:
  build:
    docker:
      - image: cimg/node:14.17.3
    steps:
      - checkout
      - run:
          command: |
            npx husky Install
          name: Install husky
      - run:
          command: |
            npm i
          name: Install package
      - run:
          command: |
            npm run eslint && npm run stylelint
          name: code lint
      - run:
          command: |
            npm run build
          name: Build
  deploy:
    docker:
      - image: cimg/node:14.17.3
    steps:
      - run:
          name: set git email 
          command: git config --global user.email "ben39053372@gmail.com"
      - run:
          name: set git name
          command: git config --global user.name "ben39053372"
      - run:
          name: set git remote
          command: git remote -v
      - run:
          command: |
            git push https://github.com/ben39053372/ipsc.git master
          name: Deploy to production branch
